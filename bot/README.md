# Telegram Bot - Система управления ролями

Полнофункциональный Telegram бот на aiogram v3 с системой управления ролями для CRM.

## Структура проекта

```
bot/
├── __init__.py
├── main.py                    # Точка входа
├── config.py                  # Конфигурация (токен, пути, города)
├── middlewares/
│   ├── __init__.py
│   └── role_middleware.py    # Middleware для проверки ролей
├── services/
│   ├── __init__.py
│   └── role_storage.py        # Работа с roles.json
├── handlers/
│   ├── __init__.py
│   ├── start.py              # Обработчик /start и регистрации
│   └── owner_role_assign.py   # Назначение ролей владельцем
├── states/
│   ├── __init__.py
│   └── register_state.py     # FSM состояния регистрации
└── keyboards/
    ├── __init__.py
    ├── inline_keyboards.py   # Inline клавиатуры
    └── reply_keyboards.py    # Reply клавиатуры для ролей
```

## Роли

1. **owner** - полный доступ ко всему
2. **manager** - может добавлять учеников и отмечать посещаемость во всех городах
3. **teacher** - может добавлять учеников и отмечать посещаемость только в своем городе
4. **smm** - может добавлять учеников, просматривать свободные места во всех городах

## Установка

1. Установите зависимости:
```bash
pip install -r requirements_bot.txt
```

2. Создайте файл `.env` в корне проекта:
```
BOT_TOKEN=your_bot_token_here
OWNER_ID=your_telegram_user_id
NOTION_API_KEY=your_notion_api_key
```

3. Запустите бота:
```bash
python bot/main.py
```

## Использование

### Регистрация нового пользователя

1. Пользователь отправляет `/start`
2. Бот запрашивает ФИО
3. Заявка отправляется владельцу
4. Владелец выбирает роль через inline-кнопки
5. Для преподавателя выбирается город
6. Пользователь получает уведомление и доступ к меню

### Формат roles.json

```json
{
  "123456789": {
    "fio": "Иванов Иван Иванович",
    "username": "ivanov",
    "role": "teacher",
    "city": "Назрань"
  }
}
```

## Меню по ролям

- **Owner**: Управление ролями, Добавить ученика, Посещаемость, Оплаты, Города, Синхронизация, Отчёты, ИИ-отчёт
- **Manager**: Добавить ученика, Посещаемость, Города
- **Teacher**: Добавить ученика, Посещаемость
- **SMM**: Добавить ученика, Свободные места

