# Инструкция по тестированию системы напоминаний

## Способ 1: Полное тестирование всех функций

Запустите полный тест, который проверит все функции:

```bash
python test_reminders.py
```

Этот скрипт проверит:
- ✅ Парсинг расписания из названий групп
- ✅ Определение, есть ли сегодня занятие
- ✅ Получение групп преподавателей
- ✅ Проверку посещаемости через Notion
- ✅ Список групп, которым нужно напоминание

## Способ 2: Быстрый тест с отправкой напоминаний

Запустите быстрый тест, который сразу проверит и отправит напоминания:

```bash
python test_reminders_quick.py
```

**Внимание:** Этот скрипт отправит реальные сообщения преподавателям, если найдутся группы без посещаемости!

## Способ 3: Тестирование с изменением времени

Если хотите протестировать отправку напоминаний прямо сейчас (не дожидаясь 19:00, 20:00 или 22:00):

1. Откройте файл `bot/services/reminder_service.py`
2. Найдите строку:
   ```python
   REMINDER_TIMES = [time(19, 0), time(20, 0), time(22, 0)]
   ```
3. Временно измените на текущее время (например, если сейчас 15:30):
   ```python
   REMINDER_TIMES = [time(15, 30), time(19, 0), time(20, 0), time(22, 0)]
   ```
4. Запустите бота:
   ```bash
   python bot/main.py
   ```
5. Подождите минуту - система проверит время и отправит напоминания
6. **Не забудьте вернуть оригинальное время обратно!**

## Способ 4: Тестирование через принудительную проверку

Создайте временный скрипт для принудительной проверки:

```python
# test_force_reminder.py
import asyncio
from bot.services.reminder_service import ReminderService
from bot.handlers.reminder_handler import ReminderHandler
from aiogram import Bot
from bot.config import BOT_TOKEN

async def force_check():
    bot = Bot(token=BOT_TOKEN)
    handler = ReminderHandler(bot)
    
    # Временно меняем время проверки
    handler.reminder_service.REMINDER_TIMES = [
        handler.reminder_service.REMINDER_TIMES[0]  # Берем первое время
    ]
    
    # Принудительно проверяем
    await handler.check_and_send_reminders()
    
    await bot.session.close()

asyncio.run(force_check())
```

## Что проверить:

### 1. Парсинг расписания
- Убедитесь, что правильно парсятся названия типа "Назрань вт/ср 14:00"
- Проверьте разные форматы дней недели

### 2. Проверка занятий
- Проверьте, что система правильно определяет, есть ли сегодня занятие
- Попробуйте с разными днями недели

### 3. Проверка посещаемости
- Убедитесь, что система правильно определяет, отмечена ли посещаемость
- Проверьте с группами, где посещаемость отмечена и не отмечена

### 4. Отправка напоминаний
- Проверьте, что напоминания отправляются только нужным преподавателям
- Убедитесь, что напоминания не дублируются
- Проверьте формат сообщения

## Ожидаемое поведение:

1. **Если сегодня нет занятий** - напоминания не отправляются
2. **Если занятие есть, но посещаемость отмечена** - напоминания не отправляются
3. **Если занятие есть, но посещаемость НЕ отмечена** - напоминания отправляются в 19:00, 20:00, 22:00
4. **Каждое напоминание отправляется только один раз в день**

## Отладка:

Если что-то не работает, проверьте:

1. **Логи бота** - там должны быть сообщения о проверке напоминаний
2. **roles.json** - убедитесь, что преподаватели правильно указаны
3. **groups.json** - проверьте, что у групп указаны преподаватели
4. **Notion API** - убедитесь, что токен правильный и есть доступ

## Примеры для тестирования:

### Тест 1: Группа с занятием сегодня
- Создайте тестовую группу с названием "Тест пн/вт 14:00"
- Если сегодня понедельник или вторник - должно быть занятие
- Если посещаемость не отмечена - должно прийти напоминание

### Тест 2: Группа без занятия сегодня
- Группа "Тест сб/вс 14:00" в будний день
- Напоминание не должно отправляться

### Тест 3: Группа с отмеченной посещаемостью
- Отметьте посещаемость для группы
- Напоминание не должно отправляться
